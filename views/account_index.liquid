{% layout "layouts/base.liquid" %}

{% block content %}
  <div class="ui container">
    <h1>나무증권 요약: {{ dateKst }}</h1>

    <button
      class="ui small button"
      hx-post="/account/update"
      hx-target="#result-update">
      update
    </button>
    <div id="result-update"></div>

    <!-- 테이블 규격으로 정렬하고 싶다 -->
    <table class="ui celled compact selectable unstackable table">
      <thead>
        {% render 'table_header.liquid'
          , label: "종합" %}
      </thead>

      <tbody>
        <tr
          {% if summary.lsnpf_amt_won > 0 %}
          class="product-positive"
          {% elsif summary.lsnpf_amt_won < 0 %}
          class="product-negative"
          {% endif %}>

          <td></td>
          <td>종합</td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td class="right aligned currency-text">{{ summary.byn_amt }}</td>
          <td class="right aligned currency-text">{{ summary.ass_amt }}</td>
          <td class="right aligned color-text currency-text">{{ summary.lsnpf_amt_won }}</td>
          <td class="right aligned color-text">{{ summary.pft_rt | round: 2 }}</td>
        </tr>
      </tbody>

      <thead>
        <tr>
          {% render 'table_header.liquid'
            , label: "계좌별" %}
        </tr>
      </thead>

      <tbody>
        {% for report in reports %}
          {% assign summary = report.summary %}
          <tr
            {% if summary.lsnpf_amt_won > 0 %}
            class="product-positive"
            {% elsif summary.lsnpf_amt_won < 0 %}
            class="product-negative"
            {% endif %}>

            <td>요약</td>
            <td>계좌 {{ report.accountId }}</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td class="right aligned currency-text">{{ summary.byn_amt }}</td>
            <td class="right aligned currency-text">{{ summary.ass_amt }}</td>
            <td class="right aligned color-text currency-text">{{ summary.lsnpf_amt_won }}</td>
            <td class="right aligned color-text">{{ summary.pft_rt | round: 2 }}</td>
          </tr>
        {% endfor %}
      </tbody>

      {% for report in reports %}
        {% assign snapshots = report.snapshots %}
        {% capture label %}
          잔고유형 {{ report.accountId }}
        {% endcapture %}

        <thead>
          {% render 'table_header.liquid'
            , label: label %}
        </thead>
        <tbody>
          {% for entry in snapshots %}
            {% render 'table_data.liquid'
              , entry: entry %}
          {% endfor %}
        </tbody>
      {% endfor %}
    </table>
  </div>

  <script>
    const currencyElements = document.querySelectorAll('.currency-text');
    for(const currencyElement of currencyElements ) {
      const v = Number.parseFloat(currencyElement.textContent);
      currencyElement.textContent = v.toLocaleString();
    }
  </script>
{% endblock %}
